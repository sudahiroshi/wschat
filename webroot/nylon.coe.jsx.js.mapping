{"version":3,"file":"nylon.coe.jsx.js","sources":["lib/built-in.jsx","nylon.coe.jsx","lib/js/js.jsx","lib/js/js/web.jsx","nylon.client.jsx"],"names":["coe","url","ws","nl","onmessage","me","e","data","parse","keys","index","indexOf","splice","emit","emitfunc","jsondata","stringify","params","send","on","onconnect","fn","onopen","onclose","close","id","document","getElementById","createElement","tag","EventInit","bubbles","cancelable","CustomEventInit","detail","MutationObserverInit","childList","attributes","characterData","subtree","attributeOldValue","characterDataOldValue","attributeFilter","UIEventInit","view","FocusEventInit","relatedTarget","MouseEventInit","screenX","screenY","clientX","clientY","ctrlKey","shiftKey","altKey","metaKey","button","buttons","region","WheelEventInit","deltaX","deltaY","deltaZ","deltaMode","KeyboardEventInit","key","location","repeat","charCode","keyCode","which","CompositionEventInit","ProgressEventInit","lengthComputable","loaded","total","XMLHttpRequestOptions","anon","ScrollOptions","behavior","ScrollOptionsHorizontal","x","ScrollOptionsVertical","y","BoxQuadOptions","box","relativeTo","ConvertCoordinateOptions","fromBox","toBox","TrackEventInit","track","PopStateEventInit","state","HashChangeEventInit","oldURL","newURL","PageTransitionEventInit","persisted","ErrorEventInit","message","filename","lineno","column","DragEventInit","dataTransfer","CloseEventInit","wasClean","code","reason","StorageEventInit","oldValue","newValue","storageArea","MessageEventInit","origin","lastEventId","source","ports","EventSourceInit","withCredentials","IDBObjectStoreParameters","keyPath","autoIncrement","IDBIndexParameters","unique","multiEntry","IDBVersionChangeEventInit","oldVersion","newVersion","NotificationOptions","titleDir","body","bodyDir","iconUrl","DOMPointInit","z","w","SourceInfo","sourceId","kind","label","MediaStreamTrackEventInit","MediaSourceStates","sourceType","width","height","frameRate","aspectRatio","facingMode","volume","CapabilityRange","max","min","supported","AllVideoCapabilities","AllAudioCapabilities","MediaStreamConstraints","video","audio","MediaTrackConstraints","mandatory","_optional","MinMaxConstraint","HitRegionOptions","path","parentID","cursor","control","role","WebGLContextAttributes","alpha","depth","stencil","antialias","premultipliedAlpha","preserveDrawingBuffer","WebGLContextEventInit","statusMessage","DeviceOrientationEventInit","beta","gamma","absolute","DeviceMotionEventInit","acceleration","accelerationIncludingGravity","rotationRate","interval","nylonfunc","func","object","obj","nylon","global","keyword","map","push","split","forEach","element","off","arr","i","length","_Main","main","args","f","g","a","b","window"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAi/BI;;;;;;;;AAmBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;SChgCEA,IAIkBC;;;CACpB,IAAKC,GAAG,GAAE,cAAeD,GAAf;CACV,IAAKE,GAAG,GAAE,UAAA;CAEV,IAAKD,GAAGE,UAAU,GAAE,CAAA,UAAA,CAAA;;;;;EACdC,EAAG,GAAI;GAAA,OAAA;;IAAA;;GAAA;EAAA,EAAFC,CAAE;EACPC,IAAK,GAAkC;GAAA,OAAA;;IAAA;;GAAA;EAAA,EAA3BC,UAAK,CAAEH,EAAGE,KAAK,KAAV,CAAsB;EACvCE,IAAK,GAAmB;GAAA,OAAA;;IAAA;;GAAA;EAAA,EAAjBF,IAAI,CAAC,QAAY;EACxBG,KAAM,GAAED,IAAKE,QAAO,CAAE,WAAF;EACxB,IAAID,KAAM,KAAG,EAAC;GACZD,IAAKG,OAAM,CAAEF,OAAO,CAAT;;EAEb,KAAKP,GAAGU,UAAI,CAAEJ,MAAMF,IAAR;CARM,CAAA;CAWhBO,QAAS,GAAE,CAAA,UAAA,MAAA;;EACTC,QAAS,GAAOC,cAAS,CAAEC,MAAF;EAC7B,KAAKf,GAAGgB,KAAI,CAAEH,QAAF;CAFC,CAAA;CAKf,IAAKZ,GAAGgB,WAAE,CAAE,aAAaL,QAAf;CACV,IAAKX,GAAGgB,WAAE,CAAE,UAAUL,QAAZ;;;;AAGHM,gDAAWC;CAClB,IAAI,IAAKnB,GAAG,IAAG;EACb,IAAKA,GAAGoB,OAAO,GAAED;;;;;AAIZE,8CAASF;CAChB,IAAKnB,GAAGqB,QAAQ,GAAEF;;;;AAGXG;CACP,IAAKtB,GAAGsB,MAAK,CAAA;;;;ACYb;;;;;;;;;;;;;AC5BaC,kBAAGA;QACqB;EAAA,OAAA;;GAAA;;EAAA;CAAA,EAA5BC,YAASC,eAAc,CAACF,EAAD,CAAK;;;;;AAOxBE,8BAAeF;QACS;EAAA,OAAA;;GAAA;;EAAA;CAAA,EAA5BC,YAASC,eAAc,CAACF,EAAD,CAAK;;;;;AAOxBG,6BAAcC;QACU;EAAA,OAAA;;GAAA;;EAAA;CAAA,EAA5BH,YAASE,cAAa,CAACC,GAAD,CAAM;;;;;SAuIlBC;C,IAGlBC,Q,G;C,IAEAC,W,G;;;;SAyBkBC;CAAAA,mBAAAA,CAAAA;C,IAGlBC,O,G;;;;SA6FkBC;C,IAElBC,U,G;C,IACAC,W,G;C,IACAC,c,G;C,IACAC,Q,G;C,IACAC,kB,G;C,IACAC,sB,G;C,IACAC,gB,G;;;;SAy4BkBC;CAAAA,mBAAAA,CAAAA;C,IAKlBC,K,G;C,IAEAV,O,G;;;;SAKkBW;C,IAElBd,Q,G;C,IACAC,W,G;C,IACAY,K,G;C,IACAV,O,G;C,IACAY,c,G;;;;SAKkBC;CAAAA,qBAAAA,CAAAA;C,IAOlBC,Q,G;C,IAEAC,Q,G;C,IAEAC,Q,G;C,IAEAC,Q,G;C,IAEAC,Q,G;C,IAEAC,S,G;C,IAEAC,O,G;C,IAEAC,Q,G;C,IAEAC,O,G;C,IAEAC,Q,G;C,IAEAX,c,G;C,IAIAY,O,G;;;;SAKkBC;C,IAElB5B,Q,G;C,IACAC,W,G;C,IACAY,K,G;C,IACAV,O,G;C,IACAc,Q,G;C,IACAC,Q,G;C,IACAC,Q,G;C,IACAC,Q,G;C,IACAC,Q,G;C,IACAC,S,G;C,IACAC,O,G;C,IACAC,Q,G;C,IACAC,O,G;C,IACAC,Q,G;C,IACAX,c,G;C,IACAc,O,G;C,IACAC,O,G;C,IACAC,O,G;C,IACAC,U,G;;;;SAKkBC;C,IAElBjC,Q,G;C,IACAC,W,G;C,IACAY,K,G;C,IACAV,O,G;C,IACA+B,I,G;C,IACAC,S,G;C,IACAd,Q,G;C,IACAC,S,G;C,IACAC,O,G;C,IACAC,Q,G;C,IACAY,O,G;C,IACAC,S,G;C,IACAC,Q,G;C,IACAC,M,G;;;;SAKkBC;C,IAElBxC,Q,G;C,IACAC,W,G;C,IACAY,K,G;C,IACAV,O,G;C,IACA3B,K,G;;;;SAqDkBiE;CAAAA,mBAAAA,CAAAA;C,IAElBC,iB,G;C,IACAC,O,G;C,IACAC,M,G;;;;SAwFkBC;C,IAElBC,K,G;;;;SA+/BkBC;C,IAElBC,S,G;;;;SAoCkBC;CAAAA,uBAAAA,CAAAA;C,IAElBC,E,G;;;;SAKkBC;CAAAA,uBAAAA,CAAAA;C,IAElBC,E,G;;;;SAyIkBC;C,IAElBC,I,G;C,IACAC,W,G;;;;SAKkBC;C,IAElBC,Q,G;C,IACAC,M,G;;;;SAk3BkBC;CAAAA,mBAAAA,CAAAA;C,IAElBC,M,G;;;;SAkkBkBC;CAAAA,mBAAAA,CAAAA;C,IAElBC,M,G;;;;SAgBkBC;CAAAA,mBAAAA,CAAAA;C,IAElBC,O,G;C,IACAC,O,G;;;;SAekBC;CAAAA,mBAAAA,CAAAA;C,IAElBC,U,G;;;;SAwEkBC;CAAAA,mBAAAA,CAAAA;C,IAGlBC,Q,G;C,IAEAC,S,G;C,IAEAC,O,G;C,IAEAC,O,G;;;;SAqLkBC;CAAAA,wBAAAA,CAAAA;C,IAElBC,a,G;;;;SAwlBkBC;CAAAA,mBAAAA,CAAAA;C,IAElBC,S,G;C,IACAC,K,G;C,IACAC,O,G;;;;SAiHkBC;CAAAA,mBAAAA,CAAAA;C,IAElB7C,I,G;C,IACA8C,S,G;C,IACAC,S,G;C,IACA/G,I,G;C,IACAgH,Y,G;;;;SAmBkBC;CAAAA,mBAAAA,CAAAA;C,IAElB3G,K,G;C,IACA4G,O,G;C,IACAC,Y,G;C,IACAC,O,G;C,IACAC,M,G;;;;SAwKkBC;C,IAElBC,gB,G;;;;SAuBkBC;C,IAElBC,Q,G;C,IACAC,c,G;;;;SAKkBC;C,IAElBC,O,G;C,IACAC,W,G;;;;SAKkBC;CAAAA,mBAAAA,CAAAA;C,IAElBC,W,G;C,IACAC,W,G;;;;SAmSkBC;C,IAElBC,S,G;C,IACAC,K,G;C,IACAC,Q,G;C,IACAxG,I,G;C,IACAyG,Q,G;;;;SA+BkBC;C,IAElBtD,E,G;C,IACAE,E,G;C,IACAqD,E,G;C,IACAC,E,G;;;;SAoOkBC;C,IAElBC,S,G;C,IACAC,K,G;C,IACAC,M,G;;;;SAKkBC;CAAAA,mBAAAA,CAAAA;C,IAElBnD,M,G;;;;SAkCkBoD;C,IAElBC,W,G;C,IACAL,S,G;C,IACAM,M,G;C,IACAC,O,G;C,IACAC,U,G;C,IACAC,Y,G;C,IACAC,W,G;C,IACAC,O,G;;;;SAKkB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","sourcesContent":[null,"import \"js.jsx\";\nimport \"js/web.jsx\";\nimport \"nylon.client.jsx\";\n\nclass coe {\n  var ws : WebSocket;\n  var nl : nylon;\n\n  function constructor( url : string ) {\n    this.ws = new WebSocket( url );\n    this.nl = new nylon();\n\n    this.ws.onmessage = function( e : Event ) : void {\n      var me = e as MessageEvent;\n      var data = JSON.parse( me.data as string ) as Map.<variant>;\n      var keys = data[\"keywords\"] as Array.<string>;\n      var index = keys.indexOf( 'broadcast' );\n      if( index != -1 ) {\n        keys.splice( index, 1 );\n      }\n      this.nl.emit( keys, data );\n    };\n\n    var emitfunc = function( params: Map.<variant> ): void {\n      var jsondata = JSON.stringify( params );\n      this.ws.send( jsondata );\n    };\n\n    this.nl.on( \"broadcast\", emitfunc );\n    this.nl.on( \"server\", emitfunc );\n  }\n\n  function onconnect( fn: function( :Event ): void ) : void {\n    if( this.ws != null ) {\n      this.ws.onopen = fn;\n    }\n  }\n\n  function onclose( fn: function( :Event ) : void ) : void {\n    this.ws.onclose = fn;\n  }\n\n  function close() : void {\n    this.ws.close();\n  }\n}\n",null,null,"import \"js.jsx\";\n\nclass nylonfunc {\n\tvar fn: function( :Map.<variant> ): void;\n\tvar obj: nylon;\n\tfunction constructor( func: function( :Map.<variant> ): void, object: nylon ) {\n\t\tthis.fn = func;\n\t\tthis.obj = object;\n\t}\n}\n\nclass nylon {\n\tstatic var map = js.global[\"map\"] as Map.<Array.<nylonfunc>>;\n\n\tfunction constructor() {\n\t\tif( js.global[\"map\"] == null )\tjs.global[\"map\"] = {}: Map.<Array.<nylonfunc>>;\n\t}\n\tfunction on( keyword: string, fn: function( :Map.<variant> ): void ): void {\n\t\tif( nylon.map[ keyword ] == null ){\n\t\t\tlog \"map - keyword is null\";\n\t\t\tnylon.map[ keyword ] = [ new nylonfunc( fn, this ) ];\n\t\t} else {\n\t\t\tnylon.map[ keyword ].push( new nylonfunc( fn, this ) );\n\t\t}\n\t}\n\tfunction emit( keyword: string, params: Map.<variant> ): void {\n\t\tlog nylon.map[keyword];\n\t\tvar keys = keyword.split( \"|\" );\n\t\tthis.emit( keys, params );\n\t}\n\tfunction emit( keys: Array.<string>, params: Map.<variant> ): void {\n\t\tif( nylon.map[\"keywords\"] == null)\tparams[\"keywords\"] = keys;\n\t\tkeys.forEach( function( key: Nullable.<string> ): void {\n\t\t\tif( nylon.map[key] == null ) {\n\t\t\t\tlog  \"Invarid keyword!\";\n\t\t\t} else {\n\t\t\t\tnylon.map[key].forEach( function( element: nylonfunc ): void {\n\t\t\t\t\tif( element.obj != this ) {\n\t\t\t\t\t\t//Timer.setTimeout( ()-> { element.fn(params); }, 0 );\n\t\t\t\t\t\telement.fn( params );\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tfunction off( keyword: string, fn: function( :Map.<variant> ): void ): void {\n\t\tif( nylon.map[ keyword ] == null ){\n\t\t\tlog \"map - keyword is null\";\n\t\t} else {\n\t\t\tvar arr = nylon.map[keyword];\n\t\t\tfor( var i=arr.length-1; i>=0; i-- ){\n\t\t\t\tlog i;\n\t\t\t\tif( arr[i].obj == this && arr[i].fn == fn ){\n\t\t\t\t\tarr.splice( i, 1 );\n\t\t\t\t}\n\t\t\t}\n\t\t\tif( nylon.map[ keyword ].length == 0 )\tnylon.map[ keyword ] = null;\n\t\t}\n\t}\n}\n\n\nclass _Main {\n\tstatic function main( args: string[] ): void {\n\t\tvar f = function( x: Map.<variant> ): void {\n\t\t\tlog \"f was executed\";\n\t\t};\n\t\tvar g = function( x: Map.<variant> ): void {\n\t\t\tlog \"g was executed\";\n\t\t};\n\n\t\tvar a = new nylon();\n\t\tlog \"check A\";\n\t\ta.on( \"test\", f );\n\t\ta.on( \"test2\", f );\n\t\tlog nylon.map;\t// for debug;\n\t\tlog \"check B\";\n\t\ta.on( \"test\", g );\n\t\tlog nylon.map;\t// for debug;\n\t\ta.emit(\"test\", {}:Map.<variant>);\t// not execute\n\n\t\tvar b = new nylon();\n\t\tlog \"check C\";\n\t\tb.emit(\"test\", null);\t// execute\n\t\tb.emit(\"test2\", null);\t// execute\n\t\ta.off( \"test\", f );\n\t\tlog \"check D\";\n\t\tlog nylon.map;\n\t\tlog \"check E\";\n\t\tb.emit(\"test|test2\", null);\n\t\tlog nylon.map;\n\t}\n}\n"]}